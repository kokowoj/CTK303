<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stinky's Reactions</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>WELCOME TO STINKY'S PLAYPLACE!!!</h1>
    <h2>Click item to grab, click again to release</h2>
  </header>

  <section id="play-area">
    <div id="area">
      <img id="dog" src="idle.png" alt="Dog">

      <img id="ball" class="item" src="ball.png" alt="ball">
      <img id="hand" class="item" src="hand.png" alt="hand">
      <img id="leash" class="item" src="leash.png" alt="leash">
      <img id="treat" class="item" src="treat.png" alt="treat">
      <img id="sit" class="item" src="sit.png" alt="sit">
    </div>
  </section>

  <script>
    const dog = document.getElementById('dog');
    const items = document.querySelectorAll('.item');
    const area = document.getElementById('area');
    const playArea = document.getElementById('play-area');

    const DOGS = {
      idle: 'idle.png',
      ball: 'soexcited.png',
      hand: 'belly.png',
      leash: 'walk.png',
      treat: 'listening.png',
      sit: 'idea.png'
    };

    let activeItem = null;
    let offsetX = 0;
    let offsetY = 0;
    let wasOverlapping = false;

    function overlap(a, b) {
      const r1 = a.getBoundingClientRect();
      const r2 = b.getBoundingClientRect();
      return !(
        r1.right < r2.left ||
        r1.left > r2.right ||
        r1.bottom < r2.top ||
        r1.top > r2.bottom
      );
    }

    function shakeDog() {
      dog.classList.remove('dog-shake');
      void dog.offsetWidth;
      dog.classList.add('dog-shake');
    }

    function createBubble() {
      const bubble = document.createElement('span');
      const size = 12 + Math.random() * 35;
      bubble.style.width = size + 'px';
      bubble.style.height = size + 'px';
      bubble.style.left = Math.random() * 100 + '%';
      playArea.appendChild(bubble);

      setTimeout(() => bubble.remove(), 8000);
    }

    setInterval(createBubble, 30);

    function update() {
      if (!activeItem) {
        dog.src = DOGS.idle;
        wasOverlapping = false;
        return;
      }

      const nowOverlapping = overlap(activeItem, dog);

      if (nowOverlapping) {
        dog.src = DOGS[activeItem.id];

        if (!wasOverlapping) {
          shakeDog();
        }
      } else {
        dog.src = DOGS.idle;
      }

      wasOverlapping = nowOverlapping;
    }

    function grab(e) {
      if (activeItem === this) {
        activeItem = null;
        this.style.left = '';
        this.style.top = '';
        update();
        return;
      }

      activeItem = this;
      const r = this.getBoundingClientRect();
      offsetX = e.clientX - r.left;
      offsetY = e.clientY - r.top;
    }

    function move(e) {
      if (!activeItem) return;

      const r = area.getBoundingClientRect();
      activeItem.style.left = e.clientX - r.left - offsetX + 'px';
      activeItem.style.top = e.clientY - r.top - offsetY + 'px';
      update();
    }

    items.forEach(item => item.addEventListener('click', grab));
    area.addEventListener('mousemove', move);
  </script>
</body>
</html>